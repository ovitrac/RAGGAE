<!doctype html>
<!--
RAGGAE Web UI v2.0
Enhanced interface with batch upload, job queue, and progress tracking.

Features:
- Drag-and-drop batch upload (all document types, ZIP, folders)
- Background indexing with real-time progress
- Job queue management
- Semantic search with provenance
- NLI-based compliance scoring

Author: Dr. Olivier Vitrac, PhD, HDR
Email: olivier.vitrac@adservio.com
Organization: Adservio
Date: December 17, 2025
License: MIT
-->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>RAGGAE ‚Ä¢ Adservio Tender AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />

  <link rel="icon" href="data:image/svg+xml,\
  <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>\
    <circle cx='50' cy='50' r='48' fill='%23FF9802'/>\
    <text x='50' y='58' font-size='54' text-anchor='middle' fill='white' font-family='Arial'>A</text>\
  </svg>"/>
  <base href="/app/" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <div class="logo">A</div>
      <div class="titles">
        <h1>RAGGAE</h1>
        <p>Adservio Tender AI ‚Äî Index ‚Ä¢ Search ‚Ä¢ Quickscore</p>
      </div>
    </div>
    <div class="status">
      <span id="health-dot" class="dot dot-off"></span>
      <span id="health-text">connecting‚Ä¶</span>
      <span id="pandoc-status" class="badge muted" style="margin-left:8px;"></span>
      <button id="btn-settings" class="btn-icon" title="Settings">‚öôÔ∏è</button>
    </div>
  </header>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3>Settings</h3>
        <button id="btn-close-settings" class="btn-close" title="Close">√ó</button>
      </div>
      <div class="modal-body">
        <div class="settings-section">
          <h4>Embedding Model</h4>
          <label>
            <select id="global-model">
              <option value="intfloat/multilingual-e5-small" selected>E5-small (multilingual)</option>
              <option value="intfloat/multilingual-e5-base">E5-base (multilingual)</option>
              <option value="BAAI/bge-small-en-v1.5">BGE-small (English)</option>
            </select>
          </label>
          <label class="inline">
            <input type="checkbox" id="global-e5" checked /> Use E5 prefixes
          </label>
        </div>

        <div class="settings-section">
          <h4>NLI Backend</h4>
          <label>
            <select id="global-nli-backend">
              <option value="ollama" selected>Ollama (local, sovereign)</option>
              <option value="claude">Claude API</option>
            </select>
          </label>
          <label>Ollama Model
            <input type="text" id="global-ollama-model" value="mistral" />
          </label>
          <div id="global-claude-options" style="display:none;">
            <label>Claude Model
              <select id="global-claude-model">
                <option value="claude-sonnet-4-20250514" selected>Sonnet 4 (recommended)</option>
                <option value="claude-opus-4-20250514">Opus 4 (best quality)</option>
                <option value="claude-haiku-3-5-20241022">Haiku 3.5 (fastest)</option>
              </select>
            </label>
            <label>Anthropic API Key
              <input type="password" id="global-api-key" placeholder="sk-ant-..." />
            </label>
          </div>
        </div>

        <div class="settings-section">
          <h4>Indexing</h4>
          <label>Default Index Name
            <input type="text" id="global-index-name" value="tender" />
          </label>
          <label>Workers
            <input type="number" id="global-workers" value="4" min="1" max="16" />
          </label>
          <label class="inline">
            <input type="checkbox" id="global-pandoc" checked /> Prefer Pandoc
          </label>
          <label>Min chars
            <input type="number" id="global-min-chars" value="40" min="0" />
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button id="btn-save-settings" class="btn btn-primary">Save Settings</button>
      </div>
    </div>
  </div>

  <main class="container">
    <nav class="tabs" role="tablist" aria-label="Primary">
      <button class="tab active" data-tab="index">Index</button>
      <button class="tab" data-tab="search">Search</button>
      <button class="tab" data-tab="quickscore">Quickscore</button>
      <button class="tab" data-tab="jobs">Jobs</button>
    </nav>

    <!-- Index Tab -->
    <section id="tab-index" class="tabpanel active" role="tabpanel">
      <!-- Drop Zone -->
      <div id="dropzone" class="dropzone-large">
        <div class="dropzone-content">
          <div class="dropzone-icon">üìÅ</div>
          <div class="dropzone-title">Drop files or folders here</div>
          <div class="dropzone-subtitle">
            PDF, DOCX, PPTX, XLSX, ODT, ODP, ODS, TXT, MD, CSV, ZIP and more
          </div>
          <div class="dropzone-actions">
            <label class="btn">
              üìÑ Select Files
              <input type="file" id="pick-files" multiple hidden />
            </label>
            <label class="btn btn-secondary">
              üìÇ Select Folder
              <input type="file" id="pick-folder" webkitdirectory directory multiple hidden />
            </label>
          </div>
        </div>
        <div id="dropzone-overlay" class="dropzone-overlay">
          <div>Drop to upload</div>
        </div>
      </div>

      <!-- File List -->
      <div id="file-list-container" class="file-list-container" style="display:none;">
        <div class="file-list-header">
          <span id="file-count">0 files selected</span>
          <button id="btn-clear-files" class="btn btn-small btn-secondary">Clear</button>
        </div>
        <div id="file-list" class="file-list"></div>
      </div>

      <!-- Upload & Index Controls (simplified) -->
      <div class="index-controls compact">
        <div class="control-row">
          <label>Index name
            <input id="index-name" type="text" placeholder="tender" required />
          </label>
          <button id="btn-upload-index" class="btn btn-primary" disabled>
            üöÄ Upload & Index
          </button>
        </div>
        <div class="index-settings-hint muted">
          Model, workers, and other settings available in ‚öôÔ∏è Settings
        </div>
      </div>

      <!-- Progress Section -->
      <div id="progress-section" class="progress-section" style="display:none;">
        <div class="progress-header">
          <span id="progress-title">Indexing...</span>
          <button id="btn-cancel-job" class="btn btn-small btn-danger">Cancel</button>
        </div>
        <div class="progress-bar-container">
          <div id="progress-bar" class="progress-bar" style="width:0%"></div>
        </div>
        <div class="progress-stats">
          <span id="progress-percent">0%</span>
          <span id="progress-files">0 / 0 files</span>
          <span id="progress-chunks">0 chunks</span>
          <span id="progress-current" class="muted"></span>
        </div>
        <div id="progress-error" class="progress-error" style="display:none;"></div>
      </div>

      <!-- Result -->
      <pre id="out-index" class="output"></pre>
    </section>

    <!-- Search Tab -->
    <section id="tab-search" class="tabpanel" role="tabpanel">
      <form id="form-search" class="search-form" onsubmit="return false;">
        <div class="search-bar">
          <input name="index_path" placeholder="Index name" value="tender" required class="search-index" />
          <input name="query" placeholder="Search query (e.g., MLflow Kubernetes ISO 27001)" required class="search-query" />
          <label class="search-k">
            Top
            <input type="number" name="k" value="10" min="1" max="100" />
          </label>
          <label class="search-ctx" title="Context lines (like grep -A/-B)">
            ¬±
            <input type="number" name="context" value="3" min="0" max="10" />
          </label>
          <button id="btn-search" class="btn btn-primary">üîç</button>
        </div>
      </form>
      <div id="hits" class="list"></div>
    </section>

    <!-- Quickscore Tab -->
    <section id="tab-quickscore" class="tabpanel" role="tabpanel">
      <form id="form-quickscore" onsubmit="return false;">
        <!-- Profile & Index Bar -->
        <div class="qs-topbar">
          <div class="profile-selector">
            <label>Profile</label>
            <select id="profile-select">
              <option value="custom">Custom</option>
              <option value="tender">üìã Tender Evaluation</option>
              <option value="cv">üë§ CV Screening</option>
              <option value="compliance">üîí Compliance Check</option>
            </select>
          </div>
          <div class="qs-index">
            <label>Index</label>
            <input name="index_path" placeholder="tender" value="tender" required />
          </div>
          <div class="qs-topk">
            <label>Top-k</label>
            <input type="number" name="topk" value="5" min="1" max="20" />
          </div>
          <div class="qs-lang">
            <label>Lang</label>
            <select name="nli_lang">
              <option value="auto" selected>auto</option>
              <option value="en">en</option>
              <option value="fr">fr</option>
            </select>
          </div>
        </div>

        <!-- Requirements -->
        <div class="qs-requirements">
          <div class="qs-req-header">
            <span>Requirements <span class="muted">(one per line)</span></span>
            <button type="button" id="btn-clear-reqs" class="btn-text">Clear</button>
          </div>
          <textarea name="requirements" rows="6" placeholder="Provider must be ISO 27001 certified&#10;Platform uses MLflow for MLOps&#10;Solution supports Kubernetes deployment"></textarea>
        </div>

        <!-- Actions -->
        <div class="qs-actions">
          <button id="btn-quickscore" class="btn btn-primary">‚ö° Evaluate</button>
          <div class="qs-export">
            <select id="export-format">
              <option value="json">JSON</option>
              <option value="csv">CSV</option>
            </select>
            <button id="btn-export" type="button" class="btn btn-secondary">üì• Export</button>
          </div>
        </div>
      </form>
      <div id="quickscore-out" class="list"></div>
    </section>

    <!-- Jobs Tab -->
    <section id="tab-jobs" class="tabpanel" role="tabpanel">
      <div class="card">
        <h2>Indexing Jobs</h2>
        <div class="jobs-controls">
          <button id="btn-refresh-jobs" class="btn btn-secondary">üîÑ Refresh</button>
          <select id="jobs-filter">
            <option value="">All</option>
            <option value="running">Running</option>
            <option value="completed">Completed</option>
            <option value="failed">Failed</option>
            <option value="cancelled">Cancelled</option>
          </select>
        </div>
        <div id="jobs-list" class="jobs-list"></div>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <div>¬© <span id="year"></span> <strong>Adservio</strong> ‚Äî RAGGAE v2.0 (Enterprise RAG) ‚Ä¢ Built with ‚ù§Ô∏è</div>
  </footer>

  <script src="script.js"></script>
</body>
</html>
